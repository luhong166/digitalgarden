---
{"dg-publish":true,"dg-path":"网络/网络学习/008-IP路由技术.md","permalink":"/网络/网络学习/008-IP路由技术/"}
---

# 一、路由信息介绍
路由中包含以下信息：
- 目的网络：标识目的网段
- 掩码：与目的地址共同标识一个网段
- 出接口：数据包被路由后离开本路由器的接口
- 下一跳：路由器转发到达目的网段的数据包所使用的下一跳地址

这些信息标识了目的网段、明确了转发IP报文的路径。

路由器通过各种方式发现路由，选择最优的路由条目放入路由表中。路由表指导设备对IP报文的转发，路由器通过对路由表的管理实现对路径信息的管理。
## 路由信息获取方式
路由器依据路由表进行路由转发，为实现路由转发，路由器需要发现路由，以下为常见的路由获取方式。
### 1.直连路由（direct）
直连路由指向本地直连网络的路由，由设备自动生成。
当路由器为路由转发的最后一跳路由器时，IP报文匹配直连路由，路由器转发IP报文到目的主机。
使用直连路由进行路由转发时，报文的目的IP和路由器接口IP在一个网段之中。
并不是所有接口生成的直连路由都会出现在路由表中，直连路由出现在路由表中的前提是该接口的物理状态、协议状态都为UP。
### 2.静态路由（static）
由网络管理员手工配置的路由条目。
### 3.动态路由
路由器运行动态路由协议学习到的路由。
# 二、默认路由
属于特殊的静态路由，写法：用0.0.0.0 0.0.0.0代表任意一个网段
由于0.0.0.0和任意一个ip地址进行与操作，其结果都为0.0.0.0，也就说明0.0.0.0与任意一个ip地址都在同一个网段。
所以用0.0.0.0 0.0.0.0来表示任意网段。也称之为默认路由。由于默认路由的掩码长度0，在路由器查找路由表时，默认路由是最后查找它（最长匹配原则）

默认路由应用的场合：默认路由这种写法局限在于当有多个出口时，不能用默认路由来写。

静态路由配置注意要点：
- 如果下一跳是以太链路连接，需要配置下一跳IP地址
- 如果下一跳是串行接口连接，可以配置下一跳IP地址或出接口名字
# 三、静态浮动路由
等价路由：路由器中去往目的网络有多条路径时，并且每条路径到达目的网络的开销值都相等时（优先级），等价路由都会被写入到路由表。
等价路由中的多条路径，可以使路由器自动开户负载均衡功能。

带宽不同GE0/0/0：千兆；Serial4/0/0：64Mbps

优先级默认为60，该值越大优先级越低

静态路由配置注意要点：
如果下一跳是以太链路连接，需要配置下一跳IP地址
如果下一跳是串行接口连接，可以配置下一跳IP地址或出接口名字

# 四、影响数据转发因素：
数据通信过程中有两个平面
- 控制平面：构建路由表的
- 转发平面：实现数据转发的，参考FIB表

数据转发因素：
1. 最长掩码匹配原则
到达目的地的路由，如果有多条路径，取掩码最长匹配的路由
2. 最优的路由优先级
到同一目的地路由，运行多种协议，如果掩码长度一样，取路由优先级最优的路由
路由优先级值越小，路由优先级越高
直连：0；静态：60；OSPF：内部10，外部150；RIP：100；BGP：255
3. 最优的路由度量
运行同一种协议，到目的地有多条路径，优选路由度量值最小的路径

# 五、命令
1. 配置静态路由

<font class="code">[Huawei] **ip route-static** *ip-address* { *mask* | *mask-length* } *nexthop-address*</font>

注：*ip-address*是目的网段；{ *mask* | *mask-length* }是目的掩码；*nexthop-address*是下一跳地址。

<font class="code">[Huawei] **ip route-static** *ip-address* { *mask* | *mask-length* } { *interface-name* | *interface-type interface-number* }</font>

注：*ip-address*是目的网段；{ *mask* | *mask-length* }是目的掩码；{ *interface-name* | *interface-type interface-number* }是出接口，仅限串口时使用。

<font class="code">[Huawei] **ip route-static 0.0.0.0 0** *nexthop-address*</font>

注：默认路由，*nexthop-address*是下一跳地址。

2. 查看路由表

<font class="code">[Huawei] **display ip routing-table**</font>

案例见[[Spaces/2-Areas/网络/网络实验案例/006-路由的综合实验案例\|/网络/网络实验案例/006-路由的综合实验案例]]