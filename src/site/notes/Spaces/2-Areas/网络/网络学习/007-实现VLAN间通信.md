---
{"dg-publish":true,"dg-path":"网络/网络学习/007-实现VLAN间通信.md","permalink":"/网络/网络学习/007-实现VLAN间通信/"}
---

# 一、技术背景
传统交换二层组网中，默认所有网络都处于同一个广播域，这带了诸多问题。[[Spaces/2-Areas/网络/网络学习/005-VLAN原理与配置\|VLAN（Virtual Local Area Network，虚拟局域网）]]技术的提出，满足了二层组网隔离广播域需求，使得属于不同VLAN的网络无法互访，但不同VLAN之间又存在着相互访问的需求。

实际网络部署中一般会将不同IP地址段划分到不同的VLAN。
同VLAN且同网段的PC之间可直接进行通信，无需借助三层转发设备，该通信方式被称为二层通信。
VLAN之间需要通过三层通信实现互访，三层通信需借助三层设备。
<style> .container {font-family: sans-serif; text-align: center;} .button-wrapper button {z-index: 1;height: 40px; width: 100px; margin: 10px;padding: 5px;} .excalidraw .App-menu_top .buttonList { display: flex;} .excalidraw-wrapper { height: 800px; margin: 50px; position: relative;} :root[dir="ltr"] .excalidraw .layer-ui__wrapper .zen-mode-transition.App-menu_bottom--transition-left {transform: none;} </style><script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@excalidraw/excalidraw@0/dist/excalidraw.production.min.js"></script><div id="excalidraw-007-实现VLAN间通信-1excalidraw.md1"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/2.15.3","elements":[{"id":"dM8FxWy0Hz0H2jU5L1Nmc","type":"rectangle","x":-67.9082290757442,"y":128.17717728639275,"width":594.1344195519347,"height":335.8995247793619,"angle":0,"strokeColor":"#99dff9","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"Zy","roundness":{"type":3},"seed":1378622629,"version":298,"versionNonce":695396133,"isDeleted":false,"boundElements":[],"updated":1758353607363,"link":null,"locked":false},{"id":"gf2EyjGXmdGxKNi704NaM","type":"rectangle","x":-903.7738095238094,"y":120.410714285714,"width":594.1344195519347,"height":335.8995247793619,"angle":0,"strokeColor":"#ffd17d","backgroundColor":"#ffffcc","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"Zz","roundness":{"type":3},"seed":1191825611,"version":245,"versionNonce":2091646565,"isDeleted":false,"boundElements":[],"updated":1758353792689,"link":null,"locked":false},{"id":"xpKDj2F-6TMdcWsBbYUgx","type":"line","x":-199.95651707519767,"y":-85.24300314358908,"width":639.3065800352537,"height":344.91938201451006,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"a2V","roundness":{"type":2},"seed":987374277,"version":248,"versionNonce":640674981,"isDeleted":false,"boundElements":[],"updated":1758354494777,"link":null,"locked":false,"points":[[0,0],[-639.3065800352537,344.91938201451006]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"polygon":false},{"id":"4aBs4yPd","type":"text","x":-701.82924259124,"y":381.5580326835416,"width":185.62686157226562,"height":61.16089613034622,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"a5","roundness":null,"seed":1851315173,"version":221,"versionNonce":1445253125,"isDeleted":false,"boundElements":[],"updated":1758353607363,"link":null,"locked":false,"text":"VLAN 10\n192.168.10.0/24","rawText":"VLAN 10\n192.168.10.0/24","fontSize":24.464358452138487,"fontFamily":6,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"VLAN 10\n192.168.10.0/24","autoResize":true,"lineHeight":1.25},{"id":"sBagCSqt","type":"text","x":133.43312628883544,"y":379.6164169333716,"width":185.62686157226562,"height":61.16089613034622,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"a6","roundness":null,"seed":508108619,"version":187,"versionNonce":259426149,"isDeleted":false,"boundElements":[],"updated":1758353607363,"link":null,"locked":false,"text":"VLAN 20\n192.168.20.0/24","rawText":"VLAN 20\n192.168.20.0/24","fontSize":24.464358452138487,"fontFamily":6,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"VLAN 20\n192.168.20.0/24","autoResize":true,"lineHeight":1.25},{"id":"adU-G-XkyOPDxKGyVcRgk","type":"line","x":-204.0541381264744,"y":-89.52020592411696,"width":208.18879891297968,"height":329.95354172333253,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"a7V","roundness":{"type":2},"seed":1401612549,"version":123,"versionNonce":68109771,"isDeleted":false,"boundElements":[],"updated":1758354486478,"link":null,"locked":false,"points":[[0,0],[-208.18879891297968,329.95354172333253]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"polygon":false},{"id":"IqLVRg8j","type":"image","x":-872.2549138460546,"y":241.1306735525169,"width":156.30006788866257,"height":120.28309572301423,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":18002,"version":321,"versionNonce":1455727915,"updated":1758353917918,"isDeleted":false,"groupIds":[],"boundElements":[{"id":"iut11P3gz69Jh1sYAD77K","type":"arrow"}],"link":null,"locked":false,"frameId":null,"fileId":"d66aa843651f0fd19b005987f0ee56baa2792171","scale":[1,1],"crop":null,"index":"a8","status":"pending"},{"id":"ZPYYWLtQfcBuuaxj4oFeD","type":"image","x":-506.2279846765589,"y":232.10216031422755,"width":156.30006788866257,"height":120.28309572301423,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":1223186245,"version":350,"versionNonce":209355851,"updated":1758354012564,"isDeleted":false,"groupIds":[],"boundElements":[{"id":"iut11P3gz69Jh1sYAD77K","type":"arrow"},{"id":"LAuVSA7hpXbFmOY2gGYw1","type":"arrow"}],"link":null,"locked":false,"frameId":null,"fileId":"d66aa843651f0fd19b005987f0ee56baa2792171","scale":[1,1],"crop":null,"index":"aA","status":"pending"},{"id":"1WpIF07SGxwchRbcxzfp7","type":"line","x":-203.21650400810142,"y":-86.52689933965411,"width":255.23175832016113,"height":415.8602394251274,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aB","roundness":{"type":2},"seed":1995350853,"version":120,"versionNonce":870562245,"isDeleted":false,"boundElements":[],"updated":1758354482061,"link":null,"locked":false,"points":[[0,0],[255.23175832016113,415.8602394251274]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"polygon":false},{"id":"0MOt4B9KHKMoyUG_vIhsP","type":"image","x":-38.18144545173584,"y":233.10225404779243,"width":156.30006788866257,"height":120.28309572301423,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":1840214891,"version":398,"versionNonce":337128843,"updated":1758354012565,"isDeleted":false,"groupIds":[],"boundElements":[{"id":"48j2joEbelF7qNezEeQli","type":"arrow"},{"id":"LAuVSA7hpXbFmOY2gGYw1","type":"arrow"}],"link":null,"locked":false,"frameId":null,"fileId":"d66aa843651f0fd19b005987f0ee56baa2792171","scale":[1,1],"crop":null,"index":"aD","status":"pending"},{"id":"OFy1WwCZd_DGkBiLwXA-u","type":"line","x":-196.57702757824268,"y":-90.50565672844192,"width":633.7926838668927,"height":317.14268126710834,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aE","roundness":{"type":2},"seed":753093163,"version":265,"versionNonce":413527979,"isDeleted":false,"boundElements":[],"updated":1758354477493,"link":null,"locked":false,"points":[[0,0],[633.7926838668927,317.14268126710834]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"polygon":false},{"id":"sRGFsDmg","type":"image","x":-279.2184218371025,"y":-155.799398043387,"width":159,"height":130,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":52041,"version":140,"versionNonce":847399051,"updated":1758354472833,"isDeleted":false,"groupIds":[],"boundElements":[],"link":null,"locked":false,"frameId":null,"fileId":"1a900850735fd33e75a08ec40935cd727f92d108","scale":[1,1],"crop":null,"index":"aF","status":"pending"},{"id":"Eg1O3td0esnAro14tGfDE","type":"image","x":330.5205460711504,"y":226.27731306371817,"width":156.30006788866257,"height":120.28309572301423,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":1534404325,"version":332,"versionNonce":1876257349,"updated":1758353940587,"isDeleted":false,"groupIds":[],"boundElements":[{"id":"48j2joEbelF7qNezEeQli","type":"arrow"}],"link":null,"locked":false,"frameId":null,"fileId":"d66aa843651f0fd19b005987f0ee56baa2792171","scale":[1,1],"crop":null,"index":"aG","status":"pending"},{"id":"rcOOn7dZ","type":"text","x":-469.7600146682188,"y":-91.81138325030793,"width":180,"height":45,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aH","roundness":null,"seed":1706075973,"version":227,"versionNonce":598910725,"isDeleted":false,"boundElements":[],"updated":1758354498361,"link":null,"locked":false,"text":"二层交换机","rawText":"二层交换机","fontSize":36,"fontFamily":6,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"二层交换机","autoResize":true,"lineHeight":1.25},{"id":"iut11P3gz69Jh1sYAD77K","type":"arrow","x":-713.8547328972738,"y":230.76202945245586,"width":190.24105534695667,"height":52.41209432571179,"angle":0,"strokeColor":"#00b0f0","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aK","roundness":{"type":2},"seed":231270853,"version":192,"versionNonce":701091979,"isDeleted":false,"boundElements":[],"updated":1758354065166,"link":null,"locked":false,"points":[[0,0],[96.77981937575544,-52.41209432571179],[190.24105534695667,-5.953616548688108]],"lastCommittedPoint":null,"startBinding":{"elementId":"IqLVRg8j","focus":-0.31028594146931177,"gap":10.580842643290845},"endBinding":{"elementId":"ZPYYWLtQfcBuuaxj4oFeD","focus":0.119745766012591,"gap":18.856400944633485},"startArrowhead":"arrow","endArrowhead":"arrow","elbowed":false},{"id":"48j2joEbelF7qNezEeQli","type":"arrow","x":128.25230407665822,"y":230.67975699392073,"width":195.16830936858145,"height":46.499389499762174,"angle":0,"strokeColor":"#00b0f0","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aL","roundness":{"type":2},"seed":1028897035,"version":257,"versionNonce":243636107,"isDeleted":false,"boundElements":[],"updated":1758353944899,"link":null,"locked":false,"points":[[0,0],[101.7070733973801,-46.499389499762174],[195.16830936858145,-1.0263625270634407]],"lastCommittedPoint":null,"startBinding":{"elementId":"0MOt4B9KHKMoyUG_vIhsP","focus":-0.23157881214444265,"gap":10.421091134904751},"endBinding":{"elementId":"Eg1O3td0esnAro14tGfDE","focus":0.15573356883250464,"gap":7.099932625910753},"startArrowhead":"arrow","endArrowhead":"arrow","elbowed":false},{"id":"6reUJmHq","type":"text","x":-585.6822786006446,"y":145.902804562396,"width":112,"height":35,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aM","roundness":null,"seed":63494693,"version":38,"versionNonce":726465989,"isDeleted":false,"boundElements":[],"updated":1758353990766,"link":null,"locked":false,"text":"二层通信","rawText":"二层通信","fontSize":28,"fontFamily":6,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"二层通信","autoResize":true,"lineHeight":1.25},{"id":"kzEOvz6g","type":"text","x":73.52221820846535,"y":149.02452547484472,"width":112,"height":35,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aN","roundness":null,"seed":624785035,"version":70,"versionNonce":233532459,"isDeleted":false,"boundElements":[],"updated":1758354070449,"link":null,"locked":false,"text":"二层通信","rawText":"二层通信","fontSize":28,"fontFamily":6,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"二层通信","autoResize":true,"lineHeight":1.25},{"id":"LAuVSA7hpXbFmOY2gGYw1","type":"arrow","x":-431.95195312595297,"y":368.5419403614587,"width":483.8563449235487,"height":113.32684249736872,"angle":0,"strokeColor":"#00b0f0","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aO","roundness":{"type":2},"seed":668469739,"version":115,"versionNonce":947328613,"isDeleted":false,"boundElements":[],"updated":1758354056978,"link":null,"locked":false,"points":[[0,0],[239.46454545096196,113.32684249736872],[483.8563449235487,0]],"lastCommittedPoint":null,"startBinding":{"elementId":"ZPYYWLtQfcBuuaxj4oFeD","focus":1.268644304955741,"gap":16.15668432421694},"endBinding":{"elementId":"0MOt4B9KHKMoyUG_vIhsP","focus":-1.2520153060502268,"gap":15.156590590652058},"startArrowhead":"arrow","endArrowhead":"arrow","elbowed":false},{"id":"PYvVIxRj","type":"text","x":-246.6872019128632,"y":509.46140537992596,"width":112,"height":35,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"#f3fbfe","fillStyle":"solid","strokeWidth":4,"strokeStyle":"solid","roughness":0,"opacity":100,"groupIds":[],"frameId":null,"index":"aP","roundness":null,"seed":265442693,"version":35,"versionNonce":507473509,"isDeleted":false,"boundElements":[],"updated":1758354092232,"link":null,"locked":false,"text":"三层通信","rawText":"三层通信","fontSize":28,"fontFamily":6,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"三层通信","autoResize":true,"lineHeight":1.25}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#1e1e1e","currentItemBackgroundColor":"#f3fbfe","currentItemFillStyle":"solid","currentItemStrokeWidth":4,"currentItemStrokeStyle":"solid","currentItemRoughness":0,"currentItemOpacity":100,"currentItemFontFamily":6,"currentItemFontSize":28,"currentItemTextAlign":"left","currentItemStartArrowhead":"arrow","currentItemEndArrowhead":"arrow","currentItemArrowType":"round","currentItemFrameRole":null,"scrollX":941.405887679932,"scrollY":591.7355807953556,"zoom":{"value":1},"currentItemRoundness":"round","gridSize":20,"gridStep":5,"gridModeEnabled":false,"gridColor":{"Bold":"rgba(217, 217, 217, 0.5)","Regular":"rgba(230, 230, 230, 0.5)"},"currentStrokeOptions":null,"frameRendering":{"enabled":true,"clip":true,"name":true,"outline":true,"markerName":true,"markerEnabled":true},"objectsSnapModeEnabled":false,"activeTool":{"type":"selection","customType":null,"locked":false,"fromSelection":false,"lastActiveTool":null}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("excalidraw-007-实现VLAN间通信-1excalidraw.md1");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>
常见的三层设备：路由器、三层交换机、防火墙等。
将二层交换机与路由器的三层接口互联，由三层设备进行路由转发来实现通信。
![../../../../Extras/Media/media-007-实现VLAN间通信-1.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-1.png)
# 二、使用路由器（物理接口、子接口）实现VLAN间通信
## 1.使用路由器物理接口
路由器三层接口作为网关，转发本网段前往其它网段的流量。
路由器三层接口无法处理携带VLAN Tag的数据帧，因此交换机上联路由器的接口需配置为Access。
路由器的一个物理接口作为一个VLAN的网关，因此存在一个VLAN就需要占用一个路由器物理接口。
路由器作为三层转发设备其接口数量较少，方案的可扩展性太差。
在二层交换机上配置VLAN，每个VLAN单独使用一个交换机接口与路由器互联。
路由器使用两个物理接口，分别作为VLAN 10及VLAN 20内PC的默认网关，使用路由器的物理接口实现VLAN之间的通信。
![../../../../Extras/Media/media-007-实现VLAN间通信-2.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-2.png)
## 2.使用路由器子接口
子接口（Sub-Interface）是基于路由器以太网接口所创建的逻辑接口，以物理接口ID+子接口ID进行标识，子接口同物理接口一样可进行三层转发。
子接口不同于物理接口，可以终结携带VLAN Tag的数据帧。
基于一个物理接口创建多个子接口，将该物理接口对接到交换机的Trunk接口，即可实现使用一个物理接口为多个VLAN提供三层转发服务。
![../../../../Extras/Media/media-007-实现VLAN间通信-3.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-3.png)
R1使用一个物理接口（GE0/0/1）与交换机SW1对接，并基于该物理接口创建两个子接口：GE0/0/1.10及GE0/0/1.20，分别使用这两个子接口作为VLAN 10及VLAN 20的默认网关。
由于三层子接口不支持VLAN报文，当它收到VLAN报文时，会将VLAN报文当成是非法报文而丢弃。因此，需要在子接口上将VLAN Tag剥掉，也就是需要VLAN终结（VLAN Termination）。

交换机连接路由器的接口类型配置为Trunk，根据报文的VLAN Tag不同，路由器将收到的报文交由对应的子接口处理。
![../../../../Extras/Media/media-007-实现VLAN间通信-4.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-4.png)
子接口终结VLAN的实质包含两个方面：
对接口接收到报文，剥除VLAN标签后进行三层转发或其他处理。
对接口发出的报文，又将相应的VLAN标签添加到报文中后再发送。
### 子接口配置示例

<font class="code">[Huawei]**interface** *interface-type interface-number.sub-interface-number*</font>

这个命令用来创建子接口。*sub-interface-number*代表物理接口内的逻辑接口通道。一般情况下，为了方便记忆，子接口ID与所要终结的VLAN ID相同。

<font class="code">[Huawei-GigabitEthernet0/0/1.10]**dot1q termination vid** *vlan-id*</font>

这个命令用来配置子接口Dot1q终结的单层VLAN ID。缺省情况，子接口没有配置dot1q终结的单层VLAN ID。**arp broadcast enable**命令用来使能终结子接口的ARP广播功能。缺省情况下，终结子接口没有使能ARP广播功能。终结子接口不能转发广播报文，在收到广播报文后它们直接把该报文丢弃。为了允许终结子接口能转发广播报文，可以通过在子接口上执行此命令。
![../../../../Extras/Media/media-007-实现VLAN间通信-5.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-5.png)
## 3.使用VLANIF技术实现VLAN间通信
二层交换机（Layer 2 Switch）指的是只具备二层交换功能的交换机。
三层交换机（Layer 3 Switch）除了具备二层交换机的功能，还支持通过三层接口（如VLANIF接口）实现路由转发功能。
VLANIF接口是一种三层的逻辑接口，支持VLAN Tag的剥离和添加，因此可以通过VLANIF接口实现VLAN之间的通信。
VLANIF接口编号与所对应的VLAN ID相同，如VLAN 10对应VLANIF 10。

<font class="code">[Huawei] **interface vlanif** *vlan-id*</font>

此命令用来创建VLANIF接口并进入到VLANIF接口视图。vlan-id表示与VLANIF接口相关联的VLAN编号。VLANIF接口的IP地址作为主机的网关IP地址，和主机的IP地址必须位于同一网段。
### VLANIF配置示例
![../../../../Extras/Media/media-007-实现VLAN间通信-6.png|300](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-6.png)
配置需求：两台PC分别属于VLAN 10、VLAN 20。通过三层交换机完成两台PC之间的相互通信。

基础配置：
```
[SW1]vlan batch 10 20
[SW1] interface GigabitEthernet 0/0/1
[SW1-GigabitEthernet0/0/1] port link-type access
[SW1-GigabitEthernet0/0/1] port default vlan 10
[SW1] interface GigabitEthernet 0/0/2
[SW1-GigabitEthernet0/0/2] port link-type access
[SW1-GigabitEthernet0/0/2] port default vlan 20
```
配置Vlanif：
```
[SW1]interface Vlanif 10
[SW1-Vlanif10]ip address 192.168.10.254 24
[SW1]interface Vlanif 20
[SW1-Vlanif20]ip address 192.168.20.254 24
```
### VLANIF转发流程 
![../../../../Extras/Media/media-007-实现VLAN间通信-7.png](/img/user/Extras/Media/media-007-%E5%AE%9E%E7%8E%B0VLAN%E9%97%B4%E9%80%9A%E4%BF%A1-7.png)
假设PC、三层交换机上都已存在相应的ARP或MAC表项。
PC1与PC2之间通信过程如下：
1. PC1通过本地IP地址、本地掩码、对端IP地址进行计算，发现目的设备PC2与自身不在同一个网段，判断该通信为三层通信，将去往PC2的流量发给网关。PC1发送的数据帧：源MAC = MAC1，目的MAC = MAC2。
2. 交换机收到PC1发送的去往PC2的报文，经解封装发现目的MAC为VLANIF20接口的MAC地址，所以将报文交给路由模块继续处理。
3. 路由模块解析发现目的IP为192.168.20.2，非本地接口存在的IP地址，因此需要对该报文三层转发。查找路由表后，匹配中VLANIF20产生的直连路由。
4. 因为匹配的为直连路由，说明已经到达最后一跳，所以交换机在ARP表中查找192.168.20.2，获取192.168.20.2的MAC地址，交由交换模块重新封装为数据帧。
5. 交换模块查找MAC地址表以明确报文出接口、是否需要携带VLAN Tag。最终交换模块发送的数据帧：源MAC = MAC2，目的MAC = MAC3，VLAN Tag = None。
# 三、二三层接口对比

|二层接口（Layer2 Interface）|三层接口（Layer3 Interface）|
|:-:|:-:|
|二层接口不能配置IP地址|三层接口可以配置IP地址|
|二层接口不具备MAC地址|三层接口具备MAC地址|
|当二层接口收到数据帧时，设备在其MAC地址表中查询该帧的目的MAC地址，找到匹配的MAC地址表项后按照该表项的指示转发帧；如果没有找到匹配的MAC地址表项，则将帧进行泛洪。|三层接口收到数据帧后，如果数据帧的目的MAC地址与设备的本地MAC地址相同，则将数据帧解除封装，然后在路由表中查询数据包的目的IP地址，找到匹配的路由表项后按照该表项的指示转发包；如果没有找到匹配的表项，则将包丢弃。|
|典型的二层接口如二层交换机（只具备二层交换能力的交换机）的物理接口；大部分三层交换机（同时具备二层及三层交换能力的交换机）的物理接口缺省为二层接口。|典型的三层接口如路由器的三层接口。某些三层交换机的物理接口可以切换成三层模式。此外除了物理三层接口，还存在逻辑三层接口，例如交换机的VLANIF，或者网络设备上的逻辑子接口，如GE0/0/1.10。|
|二层接口并不隔离广播域，当二层接口收到广播帧时，会将数据帧进行泛洪。|三层接口隔离广播域，当三层接口收到广播帧时，缺省不会进行泛洪，而是直接终结。|
***
案例见[[Spaces/2-Areas/网络/网络实验案例/004-实现VLAN间的通信案例\|/网络/网络实验案例/004-实现VLAN间的通信案例]]
***
# 参考文献
[1] 施淼淼/swx791350（华为技术有限公司）.实现VLAN间通信[PPT].(2020)[2025-09-20]