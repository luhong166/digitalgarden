---
{"dg-publish":true,"permalink":"/Spaces/2-Areas/网络/003-以太网交换基础/"}
---

# 一、以太网协议介绍
## 1.以太网协议
以太网是当今现有局域网（Local Area Network, LAN）采用的最通用的通信协议标准，该标准定义了在局域网中采用的电缆类型和信号处理方法。
以太网是建立在CSMA/CD (Carrier Sense Multiple Access/Collision Detection，载波监听多路访问/冲突检测)机制上的广播型网络。
## 2.冲突域
在共享介质环境同一时刻多个节点同时通信造成信号叠加导致信号失真称之为冲突（Collision）。
冲突产生及发生的区域称之为冲突域（Collision Domain）。

在共享网络，以太网络使用CSMA/CD技术，避免冲突问题。**CSMA/CD**的基本工作过程如下：
- 终端设备不停的检测共享线路的状态。
	- 如果线路空闲则发送数据。
	- 如果线路不空闲则一直等待。
- 如果有另外一个设备同时发送数据，两个设备发送的数据必然产生冲突，导致线路上的信号不稳定。
- 终端设备检测到这种不稳定之后，马上停止发送自己的数据。
- 终端设备发送一连串干扰脉冲，然后等待一段时间之后再进行发送数据。发送干扰脉冲的目的是为了通知其他设备，特别是跟自己在同一个时刻发送数据的设备，线路上已经产生了冲突。

CSMA/CD的工作原理可简单总结为：先听后发，边发边听，冲突停发，随机延迟后重发。

冲突隔离，通过冲突域分段。
- 分段目的：减少冲突，提升网络性能
- 分段结果：冲突域个数增加，冲突域规模减小
- 分段实现：
- 使用通信设备实现冲突域分段：
	- 早期HUB：HUB是物理层设备，实现信号的放大和再生
		- HUB连接网络是一个冲突域，<font color="red">HUB不能对冲突域分段</font>，只能扩展冲突域
	- **Switch**：传统的交换机是工作在数据链路层上，交换机每一个端口是一个冲突域，交换机是可以隔离冲突域的
	- **Router**：路由器是工作在网络层上的设备，路由器的每一个端口是冲突域的一个部分，至于每一个部分冲突域个数取决于路由器端口互联的设备。
## 3.广播域
**广播**：能够同一时刻将一个帧发送到同一个广播域所有主机
**广播域**：广播报文所能到达的整个访问范围称为二层广播域，简称广播域，同一广播域内的主机都能收到广播报文。
**广播地址**：全1MAC地址FF-FF-FF-FF-FF-FF为广播地址，所有节点都会处理目的地址为广播地址的数据帧。
**广播风暴**：网络中有大量广播帧被多次转发，导致线路带宽被消耗殆尽网络通讯瘫痪称之为广播风暴。
<br>
广播域分段：

分段目的：减少广播风暴产生，提升网络性能

分段实现：
利用网络设备来实现分段广播域：

- HUB是物理层设备，所有网络既是一个冲突域也是一个广播域
- 交换机没有划分VLAN情况下，所有端口是一个广播域，若划分VLAN，则一个VLAN是一个广播域
- 路由器每一个端口是一个广播域

分段结果：广播域个数增加，广播域规模减小
## 4.以太网卡
网络接口卡（Network Interface Card, NIC）也称为“网卡”，是计算机、交换机、路由器等网络设备与外部网络世界相连的关键部件。

**网络接口**：简称“网口”或“接口”或“端口”。
**网卡**：每个网口都有一块网卡与之对应。计算机或交换机通过网卡来转发数据。
# 二、以太网帧介绍
## 1.以太网帧格式
以太网技术所使用的帧称为以太网帧 (Ethernet Frame)，或简称以太帧。
以太帧的格式有两个标准：Ethernet_II格式和IEEE 802.3格式。

![../../../Extras/Media/media-003-以太网交换基础-1.png](/img/user/Extras/Media/media-003-%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%9F%BA%E7%A1%80-1.png)

- Ethernet Ⅱ以太帧：
	- DMAC：6字节，目的MAC地址，IPV4为6字节，该字段标识帧的接收者。 
	- SMAC：6字节，源MAC地址，IPV4为6字节，该字段标识帧的发送者。 
	- Type：2字节，协议类型。常见值：
		- 0x0800：Internet Protocol Version 4 (IPv4) ；
		- 0x0806：Address Resolution Protocol (ARP) 。
- IEEE 802.3 LLC以太帧：
	- 逻辑链路控制LLC（Logical Link Control）由目的服务访问点DSAP（Destination Service Access Point）、源服务访问点SSAP（Source Service Access Point）和Control字段组成。
		- DSAP：1字节，目的服务访问点，若后面类型为IP值设为0x06。服务访问点的功能类似于Ethernet II帧中的Type字段或TCP/UDP传输协议中的端口号。 
		- SSAP：1字节，源服务访问点，若后面类型为IP值设为0x06。 
		- Ctrl：1字节，该字段值通常设为0x03，表示无连接服务的IEEE 802.2无编号数据格式。 
	- SNAP（Sub-network Access Protocol）由机构代码（Org Code）和类型（Type）字段组成。
		- Org Code三个字节都为0。
		- Type字段的含义与Ethernet_II帧中的Type字段相同。
- 数据帧的总长度为64-1518字节，这样设计的原因是什么？（另外，以太网口的最大传输单元是1500字节，即MTU=1500B。）
	- 以太网中，最小帧长为64字节，这是由最大传输距离和CSMA/CD机制共同决定的。
		- 规定最小帧长是为了避免这种情况发生：A站点已经将一个数据包的最后一个Bit发送完毕，但这个报文的第一个Bit还没有传送到距离很远的B站点。B站点认为线路空闲继续发送数据，导致冲突。
		- 高层协议必须保证Data域至少包含46字节，这样加上以太网帧头的14字节和帧尾的4字节校验码正好满足64字节的最小帧长，如果实际数据不足46个字节，则高层协议必须填充一些数据单元。
	- 而出于对传输效率和传输可靠性的折中考虑，使得以太网帧的最大长度为1518字节，对应IP数据包就是1500字节。
		- 较大的帧长度，数据的有效传输效率会更高；但是数据帧过长，传输时会占用共享链路过多的时间，对时延敏感应用造成极大的影响。
		- 因此最终选择了一个折中的长度：1518字节的数据帧长，对应1500字节的IP数据包长度，这就是最大传输单元MTU的由来。
## 2.MAC地址
### （1）什么是MAC地址
MAC (Medium Access Control)地址在网络中唯一标识一个网卡，每个网卡都需要并拥有有唯一的一个MAC地址。
一块网卡的MAC地址是具有全球唯一性的。

MAC地址是在IEEE 802标准中定义并规范的，凡是符合IEEE 802标准的以太网卡，都必须拥有一个MAC地址，用MAC地址来定义网络设备的位置。不同的网卡，MAC地址也不同。

**IP地址 vs MAC地址**：
- 每个以太网设备在出厂时都有一个唯一的MAC地址，那为什么还需要为每台主机再分配一个IP地址呢？或者说每台主机都分配唯一的IP地址了，为什么还要在网络设备 (如：网卡) 生产时内嵌一个唯一的MAC地址呢？
- 主要原因有：
	- IP地址是根据网络的拓朴结构分配的，MAC地址是根据制造商分配的，若路由选择建立在设备制造商的基础上，这种方案是不可行的。
	- 当存在两层地址寻址时，设备更灵活，易于移动和维修。
		- 例如，如果一个以太网卡坏了，可以被更换，而无须更换一个新的IP地址；如果一个IP主机从一个网络移到另一个网络，可以给它一个新的IP地址，而无须换一个新的网卡。
- 总结：
	- IP地址的作用是唯一标识网络中的一个节点，可以通过IP地址进行不同网段的数据访问。
	- MAC地址的作用是唯一标识一个网卡，可以通过MAC地址进行同网段的数据访问。
### （2）MAC地址表示
一个MAC地址有48 bit，6 Byte。MAC地址通常采用“十六进制”+“-”表示。
如：00-1E-10-DD-DD-02或001E-10DD-DD02。
### （3）MAC地址构成及分类
一个制造商在生产制造网卡之前，必须先向IEEE注册，以获取一个长度为24bit (3字节)的厂商代码，也称为OUI（Organizationally Unique Identifier）。后24bit由厂商自行分派，是各个厂商制造的所有网卡的唯一编号。

MAC地址可以分为3种类型：
1. **单播MAC地址**：
	- 也称物理MAC地址，这种类型的MAC地址唯一的标识了以太网上的一个终端，该地址为全球唯一的硬件地址。单播MAC地址用于标识链路上的一个单一节点。目的MAC地址为单播MAC地址的帧发往一个单一的节点。单播MAC地址可以作为源或目的地址。
	- 注意：单播MAC地址具有全球唯一性，当一个二层网络中接入了两台具有相同MAC地址的终端时（例如误操作等），将会引发通信故障（例如这两台终端无法相互通信），且其他设备与它们之间的通信也会存在问题。
2. **广播MAC地址**：
	- 全1的MAC地址（FF-FF-FF-FF-FF-FF），用来表示局域网上的所有终端设备。广播MAC地址可以理解为一种特殊的组播MAC地址。目的MAC地址为广播MAC地址的帧发往链路上的所有节点。
3. **组播MAC地址**：
	- 除广播地址外，第8bit为1的MAC地址为组播MAC地址（例如01-00-00-00-00-00），用来代表局域网上的一组终端。组播MAC地址用于标识链路上的一组节点。目的MAC地址为组播MAC地址的帧发往一组节点。组播MAC地址不能作为源地址，只能作为目的地址。

![](/img/user/Extras/Media/media-003-以太网交换基础-2.png)
## 3.单播、广播、组播
### （1）单播以太帧
单播，指从单一的源端发送到单一的目的端。
每个主机接口由一个MAC地址唯一标识，MAC地址的OUI中，第一字节第8个比特表示地址类型。对于主机MAC地址，这个比特固定为0，表示目的MAC地址为此MAC地址的帧都是发送到某个唯一的目的端。
在同一广播域中，所有主机都能收到源主机发送的单播帧，但是其他主机发现目的地址与本地MAC地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧。
### （2）广播以太帧
广播表示帧从单一的源发送到共享以太网上的所有主机。
广播帧的目的MAC地址为十六进制的FF-FF-FF-FF-FF-FF，所有收到该广播帧的主机都要接收并处理这个帧。
广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能。
当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式。
### （3）组播以太帧
组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的MAC地址为该组播MAC地址的帧。
组播MAC地址和单播MAC地址是通过第一字节中的第8个比特区分的。组播MAC地址的第8个比特为1。
当需要网络上的一组主机（而不是全部主机）接收相同信息，并且其他主机不受影响的情况下通常会使用组播方式。
# 三、以太网交换机介绍
<big>**园区网典型架构：**</big>
![](/img/user/Extras/Media/media-003-以太网交换基础-3.png)
## 1.以太网二层交换机和三层交换机
- 以太网二层交换机：
	- 在园区网络中，交换机一般来说是距离终端用户最近的设备，用于终端接入园区网，接入层的交换机一般为二层交换机。
	- 二层交换设备工作在TCP/IP对等模型的第二层，即数据链路层，它对数据包的转发是建立在MAC（Media Access Control ）地址基础之上的。
- 以太网三层交换机：
	- 不同局域网之间的网络互通由需要由路由器来完成。随着数据通信网络范围的不断扩大，网络业务的不断丰富，网络间互访的需求越来越大，而路由器由于自身成本高、转发性能低、接口数量少等特点无法很好的满足网络发展的需求。因此出现了三层交换机这样一种能实现高速三层转发的设备。

注意：本章节中所涉及的交换机，均指以太网二层交换机。
## 2.交换机的工作原理
二层交换机工作在数据链路层，它对数据帧的转发是建立在MAC地址基础之上的。交换机不同的接口发送和接收数据是独立的，各接口属于不同的冲突域，因此有效地隔离了网络中的冲突域。
二层交换设备通过学习以太网数据帧的源MAC地址来维护MAC地址与接口的对应关系（保存MAC与接口对应关系的表称为MAC地址表），通过其目的MAC地址来查找MAC地址表决定向哪个接口转发。

交换机的功能：**学习**、**泛洪**、**转发**、**丢弃**

每台交换机中都有一个MAC地址表，存放了MAC地址与交换机端口编号之间的映射关系。交换机在转发数据帧时，根据数据帧的目的MAC地址查询MAC地址表。如果MAC地址表中包含与该帧目的MAC地址对应的表项，则直接通过该表项中的出接口转发该报文；如果MAC地址表中没有包含该帧目的MAC地址对应的表项时，交换机将采取泛洪方式在除接收接口外的所有接口发送该报文。


***
# 参考文献
[1] 华为技术有限公司.以太网交换基础[PPT].(2020)[2025-09-13]